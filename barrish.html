<!doctype html>
<meta charset="utf-8">
<title>Barrish Calculator</title>
<link rel="stylesheet" href="reset.css">
<link rel="stylesheet" href="typebase.css">
<link rel="stylesheet" href="animate.css">
<link rel="stylesheet" href="whatnot.css">
<script src="lib/coffee-script.js"></script>
<script src="lib/jquery-2.1.4.js"></script>
<label>
	<h2>Input</h2>
	<textarea id="input">!Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non lobortis eros. Morbi erat dolor, placerat ut consectetur id, congue in ligula. In viverra consectetur ultrices. Sed hendrerit vitae tortor at mollis. Pellentesque feugiat felis nulla, ut tempor purus pharetra at.
	</textarea>
</label>
<label>
	<h2>Output</h2>
	<textarea id="output"></textarea>
</label>
<script type="text/coffeescript">
	
	wind = (word)->
		t = (" " for [0..500])
		b = (" " for [0..500])
		x = 0
		p = 0
		for c, i in word
			if p % 4 in [1, 2] and c.match /\w/
				t[x] = c
			else
				b[x] = c
			if p % 2 is 1
				x++
			if c.match /\w/
				p += 1
			else
				x += 1
		[t.join(""), b.join("")]
	
	wind_text = (text)->
		words = text.split(" ")
		tl = ""
		bl = ""
		for word in words
			[wtl, wbl] = wind word
			tl += wtl.replace(/\s+$/, "") + " "
			bl += wbl.replace(/\s+$/, "") + " "
			tl += " " if tl.length < bl.length
			bl += " " if bl.length < tl.length
		"#{tl}\n#{bl}"
	
	input = document.getElementById("input")
	output = document.getElementById("output")
	do input.onchange = input.oninput = input.onkeyup = ->
		_text = ""
		for c in input.value
			_text += c unless c.charCodeAt(0) in [810, 865]
		
		text = _text
			.replace /p̪/g, "P" # pt
			.replace /v/g, "V" # this is Very silly with a capital V
			.replace /pj/g, "7"
			.replace /hh/g, "x"
			.replace /\[p̪͡f\]|\[pf\]/g, "9" # pf
			.replace /\/dzh\//g, "D" # dzh
			.replace /\/ng\//g, "g" # ng
			.replace /ʉ/g, "u" # oo
			.replace /ɐ/g, "A"
			.replace /ʌ/g, "v" # uh
			.replace /\/ju\//g, "J" # ju
			.replace /e̞/g, "i" # ih
			.replace /ɘ/g, "E" # eh
			.replace /\s\./g, ";"
			.replace /!\s/g, "!"
			.replace /\.|·/g, "" # dots can separate syllables
		output.value = wind_text text
	
</script>
