<!doctype html>
<meta charset="utf-8">
<title>Barrish Calculator</title>
<link rel="stylesheet" href="reset.css">
<!-- <link rel="stylesheet" href="typebase.css"> -->
<!-- <link rel="stylesheet" href="animate.css"> -->
<!-- <link rel="stylesheet" href="whatnot.css"> -->
<script src="lib/coffee-script.js"></script>
<script src="lib/jquery-2.1.4.js"></script>
<script src="helpers.coffee" type="text/coffeescript"></script>
<!--
<label>
	<h2>Input</h2>
	<textarea id="input">!Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non lobortis eros. Morbi erat dolor, placerat ut consectetur id, congue in ligula. In viverra consectetur ultrices. Sed hendrerit vitae tortor at mollis. Pellentesque feugiat felis nulla, ut tempor purus pharetra at.
	</textarea>
</label>
<label>
	<h2>Output</h2>
	<textarea id="output"></textarea>
</label>
-->
<script type="text/coffeescript">
	
	# input = document.getElementById("input")
	# output = document.getElementById("output")
	# do input.onchange = input.oninput = input.onkeyup = ->
	
	normalize = (text)->
		_text = ""
		for c in text
			_text += c unless c.charCodeAt(0) in [810, 865]
		_text
			.replace /p̪/g, "P" # pt
			.replace /v/g, "V" # this is Very silly with a capital V
			.replace /pj/g, "7"
			# .replace /hh/g, "x"
			.replace /\[p̪͡f\]|\[pf\]/g, "9" # pf
			.replace /\/dzh\//g, "D" # dzh
			.replace /\/ng\//g, "g" # ng
			.replace /ʉ/g, "u" # oo
			.replace /ɐ/g, "A"
			.replace /ʌ/g, "v" # uh
			.replace /\/ju\//g, "J" # ju
			.replace /e̞/g, "i" # ih
			.replace /ɘ/g, "E" # eh
			.replace /\s\./g, ";"
			.replace /!\s/g, "!"
			.replace /\.|·/g, "" # dots can separate syllables
	
	separate_gylphs = (text)->
		# pair up the first two if there's two
		# pair up the next two if there's four
		syllables = text.split(/\.|·/g)
		glyphs = []
		for syllable in syllables
			# letters = normalize(syllable).split("")
			letters = normalize(syllable)
			# if letters.length >= 4
			# 	glyphs.push(letters.slice(2, 4))
			# 	glyphs.push(letters.slice(0, 2))
			# else if letters.length >= 2
			# 	glyphs.push(letters.slice(0, 2))
			# 	if letters.length >= 2
			# 		glyphs.push(letters[2])
			# else
			# 	glyphs.push(letters[0])
			# 	if letters.length >= 1
			# 		glyphs.push(letters[1])
			i = 0
			while i < letters.length
				if i + 1 < letters.length
					glyphs.push(letters.substr(i, 2))
				else
					glyphs.push(letters[i])
				i += 2
		# console.log text, glyphs
		glyphs
	
	$.get "lexicon.txt", (text)->
		words =
			for [word, definition] in colon_separated lines_of text
				word
		
		# character_occurrences = new Map
		# 
		# for word in words
		# 	for character in normalize(word)
		# 		character_occurrences[character] ?= 0
		# 		character_occurrences[character] += 1
		# 
		# console.log character_occurrences
		
		# glyph_occurrences = new Map
		glyph_occurrences = {}
		
		for word in words
			for glyph in separate_gylphs(word)
				glyph_occurrences[glyph] ?= 0
				glyph_occurrences[glyph] += 1
		
		console.log glyph_occurrences
		# kv = glyph_occurrences.entries()
		# kv.sort (a, b)-> a[0] - b[0]
		# console.log kv
		
		sortable_glyph_occurrences = []
		for glyph, occurrences of glyph_occurrences
			sortable_glyph_occurrences.push {glyph, occurrences}
		
		sortable_glyph_occurrences.sort (a, b)-> a.occurrences - b.occurrences
		
		# sorted_glyph_occurrences = {}
		# sorted_glyph_occurrences[glyph] = occurrences for {glyph, occurrences} in sortable_glyph_occurrences
		# console.log sorted_glyph_occurrences
		
		do make_glyph_occurrences_table = ->
			table = document.createElement "table"
			for {glyph, occurrences} in sortable_glyph_occurrences
				tr = document.createElement "tr"
				glyph_td = document.createElement "td"
				occurrences_td = document.createElement "td"
				glyph_td.textContent = glyph
				occurrences_td.textContent = occurrences
				tr.appendChild(glyph_td)
				tr.appendChild(occurrences_td)
				table.appendChild(tr)
			document.body.appendChild(table)
		
		do make_other_better_glyph_occurrences_table = ->
			table = document.createElement "table"
			size = 71 # 91.5 # 2148 * 1/30
			table.style.width = "#{size * 30}px"
			table.style.height = "#{size * 30}px"
			# for y in [0..30]
			for y in [1...30]
				tr = document.createElement "tr"
				# for x in [0..30]
				for x in [1...30]
					td = document.createElement "td"
					# td.textContent = glyph_occurrences[glyph]
					# td.style.backgroundImage = "url(font/barrish-different.png) " # "url(font/barrish.png)" # "url(font/barrish.svg)"
					td.style.backgroundImage = "url(font/barrish-3.png)"
					# td.style.backgroundPosition = "#{-2148 * x/30}px #{-(20 + (2253-20) * y/31)}px"
					# td.style.width = "#{2148 * 1/30}px"
					# td.style.height = "#{(2253-20) * 1/31}px"
					# td.style.backgroundPosition = "#{-x * size}px #{-(size + y*size)}px"
					td.style.backgroundPosition = "#{-x * size}px #{-y * size}px"
					td.style.width = "#{size}px"
					td.style.height = "#{size}px"
					td.style.opacity = if Math.random() < 0.2 then "0.5" else "1"
					tr.appendChild(td)
				table.appendChild(tr)
			document.body.appendChild(table)
	
</script>
