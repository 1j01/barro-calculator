<!doctype html>
<meta charset="utf-8">
<title>Barrish Calculator</title>
<link rel="stylesheet" href="reset.css">
<link rel="stylesheet" href="typebase.css">
<link rel="stylesheet" href="animate.css">
<link rel="stylesheet" href="whatnot.css">
<script src="lib/coffee-script.js"></script>
<script src="lib/jquery-2.1.4.js"></script>
<script src="helpers.coffee" type="text/coffeescript"></script>
<!--
<label>
	<h2>Input</h2>
	<textarea id="input">!Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non lobortis eros. Morbi erat dolor, placerat ut consectetur id, congue in ligula. In viverra consectetur ultrices. Sed hendrerit vitae tortor at mollis. Pellentesque feugiat felis nulla, ut tempor purus pharetra at.
	</textarea>
</label>
<label>
	<h2>Output</h2>
	<textarea id="output"></textarea>
</label>
-->
<script type="text/coffeescript">
	
	# input = document.getElementById("input")
	# output = document.getElementById("output")
	# do input.onchange = input.oninput = input.onkeyup = ->
	
	normalize = (text)->
		_text = ""
		for c in text
			_text += c unless c.charCodeAt(0) in [810, 865]
		_text
			.replace /p̪/g, "P" # pt
			.replace /v/g, "V" # this is Very silly with a capital V
			.replace /pj/g, "7"
			# .replace /hh/g, "x"
			.replace /\[p̪͡f\]|\[pf\]/g, "9" # pf
			.replace /\/dzh\//g, "D" # dzh
			.replace /\/ng\//g, "g" # ng
			.replace /ʉ/g, "u" # oo
			.replace /ɐ/g, "A"
			.replace /ʌ/g, "v" # uh
			.replace /\/ju\//g, "J" # ju
			.replace /e̞/g, "i" # ih
			.replace /ɘ/g, "E" # eh
			.replace /\s\./g, ";"
			.replace /!\s/g, "!"
			.replace /\.|·/g, "" # dots can separate syllables
	
	separate_gylphs = (text)->
		syllables = text.split(/\.|·/g)
		glyphs = []
		for syllable in syllables
			letters = normalize(syllable)
			i = 0
			while i < letters.length
				if i + 1 < letters.length
					glyphs.push(letters.substr(i, 2))
				else
					glyphs.push(letters[i])
				i += 2
		glyphs
	
	vowels =
		oo: "ʉ"
		ay: "a"
		ey: "a"
		ah: "ɐ"
		ee: "e"
		uh: "ʌ"
		ju: "/ju/"
		ih: "e̞"
		oh: "o"
		eh: "ɘ"
	
	$.get "lexicon.txt", (text)->
		words =
			for [word, definition] in colon_separated lines_of text
				word
		
		glyph_occurrences = {}
		
		for word in words
			for glyph in separate_gylphs(word)
				glyph_occurrences[glyph] ?= 0
				glyph_occurrences[glyph] += 1
		
		sortable_glyph_occurrences = []
		for glyph, occurrences of glyph_occurrences
			sortable_glyph_occurrences.push {glyph, occurrences}
		
		sortable_glyph_occurrences.sort (a, b)-> a.occurrences - b.occurrences
		
		# do make_glyph_occurrences_table = ->
		# 	table = document.createElement "table"
		# 	for {glyph, occurrences} in sortable_glyph_occurrences
		# 		tr = document.createElement "tr"
		# 		glyph_td = document.createElement "td"
		# 		occurrences_td = document.createElement "td"
		# 		glyph_td.textContent = glyph
		# 		occurrences_td.textContent = occurrences
		# 		tr.appendChild(glyph_td)
		# 		tr.appendChild(occurrences_td)
		# 		table.appendChild(tr)
		# 	document.body.appendChild(table)
		
		table_container = document.createElement "div"
		table_container.className = "table-container"
		do make_other_better_glyph_occurrences_table = ->
			table = document.createElement "div"
			table.className = "table"
			table.style.position = "relative"
			size = 71 * 2
			table.style.width = "#{size * 30}px"
			table.style.height = "#{size * 31}px"
			for y in [0...31]
				for x in [0...30]
					glyph_el = document.createElement "div"
					glyph_el.style.backgroundImage = "url(font/barrish-hd.png)" # "url(font/barrish.svg)"
					glyph_el.style.backgroundPosition = "#{1 - x * size}px #{1 - y * size}px"
					glyph_el.style.position = "absolute"
					glyph_el.style.left = "#{x * size}px"
					glyph_el.style.top = "#{y * size}px"
					glyph_el.style.width = "#{size}px"
					glyph_el.style.height = "#{size}px"
					glyph_el.style.opacity = if Math.random() < 0.2 then "0.5" else "1"
					table.appendChild(glyph_el)
			table_container.appendChild(table)
			document.body.appendChild(table_container)
			document.body.style.maxWidth = document.body.style.width = "calc(" + table.style.width + " + " + getComputedStyle(table_container).paddingLeft + " + " + getComputedStyle(table_container).paddingRight + ")"
	
</script>
